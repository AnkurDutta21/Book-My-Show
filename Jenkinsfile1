pipeline {
    agent any

    tools {
        nodejs 'node23'
    }

    stages {

        stage('Clean Workspace') {
            steps {
                cleanWs()
            }
        }

        stage('Checkout from Git') {
            steps {
                git branch: 'main', url: 'https://github.com/AnkurDutta21/Book-My-Show.git'
                sh 'ls -la'
            }
        }

        stage("Install NPM Dependencies") {
    steps {
        sh """
            cd bookmyshow-app
            npm install
        """
    }
}

        stage('Build docker image') {
            steps {
                sh 'docker build --no-cache -t bms -f bookmyshow-app/Dockerfile bookmyshow-app'
            }
        }

        stage('Docker Build & Push') {
            steps {
                withCredentials([string(credentialsId: 'DOCKER_HUB_PASSWORD', variable: 'DOCKER_HUB_PASSWORD')]) {
                    sh 'docker login -u ankurdutta2212 -p ${DOCKER_HUB_PASSWORD}'
                }

                sh 'docker tag bms ankurdutta2212/bms'
                sh 'docker push ankurdutta2212/bms'
            }
        }

stage('Deploy to Container') {
    steps {
        sh 'docker run -d --restart=always -p 3000:80 ankurdutta2212/bms'

        echo "Checking running containers..."
        sh 'docker ps -a'
    }
}

    }
}
